# TurtleCat

이미지를 입력하면
**밝기 변화가 거의 없는 인접 영역을 하나의 ‘면(region)’으로 묶고**,
각 면의 **평균 밝기**를 사용해
**서로 인접한 면은 다른 방향의 해칭(hatching)** 으로
`turtle` 그래픽으로 이미지를 그려주는 프로그램입니다.

* 면 단위 처리 → 노이즈 감소, 회화적인 결과
* 4색 정리 개념 적용 → 인접 면은 서로 다른 방향
* 밝기에 따라 선 간격 변화 → 자연스러운 명암 표현
* 영역 외곽을 따라 **매끈한 벡터 테두리** 자동 생성

---

## ✨ 특징

* 입력 이미지 → 흑백 변환
* **강화된 영역 분할(테두리 추출 강화)**

  * 블러로 노이즈 완화
  * Sobel 에지(경계)를 “벽”처럼 사용해 경계를 넘지 않는 **에지-인식 Region Growing**
  * 너무 작은 영역은 주변 영역으로 **자동 병합**
* 각 영역:

  * 평균 밝기 계산
  * 해칭 선 간격 자동 조절
* 인접 영역끼리:

  * **4방향만 사용**

    * 가로
    * 세로
    * 왼쪽 아래 ↗ 대각선
    * 왼쪽 위 ↘ 대각선
* DSATUR 기반 **4색 정리(방향 할당)**

  * 빠른 비재귀 방식 + 충돌 자동 보정
* 영역 경계(테두리):

  * 픽셀 경계 기반 **벡터 컨투어 추적**
  * RDP 단순화 + Chaikin 스무딩으로 매끈한 테두리
  * **기본값: 테두리 표시 ON**
* 터틀 렌더링:

  * 이미지 크기에 따라 **자동 화면 스케일링**

    * 작은 이미지는 확대
    * 큰 이미지는 축소
  * 속도 조절 가능
  * 펜 색 / 배경 색 지정 가능

---

## 📁 파일 구성

```text
.
├─ turtle_region_hatch.py   # 메인 실행 파일
├─ requirements.txt         # pillow 포함
└─ README.md
```

---

## ⚙️ 설치

가상환경 사용을 권장합니다.

```bash
pip install -r requirements.txt
```

---

## ▶️ 실행 방법

```bash
python turtle_region_hatch.py <이미지경로> [옵션]
```

### 예시

```bash
python turtle_region_hatch.py Sample\building.png \
  --max-side 240 \
  --tolerance 24 \
  --pen-color black \
  --bg-color white \
  --speed 0
```

실행이 끝나면 **창을 클릭하면 종료**됩니다.

---

## 🧩 옵션 설명

### 기본 옵션

| 옵션               | 설명                        | 기본값     |
| ---------------- | ------------------------- | ------- |
| `--max-side`     | 이미지의 최대 변 길이              | `240`   |
| `--tolerance`    | 영역 확장 허용 밝기 차이(클수록 면이 커짐) | `24`    |
| `--min-gap`      | 가장 어두운 면의 선 간격            | `1`     |
| `--max-gap`      | 가장 밝은 면의 선 간격             | `10`    |
| `--pen-size`     | 터틀 펜 두께                   | `1`     |
| `--pen-color`    | 선 색상                      | `black` |
| `--bg-color`     | 배경 색상                     | `white` |
| `--speed`        | 터틀 속도 (`0`이 최속)           | `0`     |
| `--update-every` | 화면 갱신 주기(영역 단위)           | `8`     |

### 영역 분할(테두리 추출 강화) 옵션

| 옵션             | 설명                        | 기본값  |
| -------------- | ------------------------- | ---- |
| `--blur`       | 전처리 블러 반경(노이즈 감소)         | `1`  |
| `--edge-th`    | 에지 임계값(낮을수록 경계가 더 강하게 막힘) | `28` |
| `--min-region` | 이 픽셀 수보다 작은 영역 병합         | `80` |

### 테두리(컨투어) 옵션

> 기본값: **테두리 표시됨**

| 옵션                  | 설명             | 기본값     |
| ------------------- | -------------- | ------- |
| `--no-outline`      | 영역 테두리 끄기      | OFF     |
| `--outline-color`   | 테두리 색상         | `black` |
| `--outline-size`    | 테두리 펜 두께       | `1`     |
| `--outline-epsilon` | 컨투어 단순화 강도(px) | `1.2`   |
| `--outline-smooth`  | 스무딩 반복 횟수      | `1`     |

---

## 🎨 방향 규칙 (4색 정리)

각 영역은 아래 **4가지 중 하나의 방향**을 가집니다.

| 번호 | 방향              |
| -- | --------------- |
| 0  | 가로              |
| 1  | 세로              |
| 2  | ↗ 대각선 (좌하 → 우상) |
| 3  | ↘ 대각선 (좌상 → 우하) |

서로 맞닿아 있는 영역은 **절대 같은 방향을 공유하지 않습니다**.

---

## 🔧 파라미터 튜닝 가이드

### 면을 크게 만들고 싶을 때

```bash
--tolerance 24
--min-region 120
```

### 너무 잘게 쪼개질 때(사소한 조각 줄이기)

```bash
--blur 2 --min-region 150
```

### 경계를 더 또렷하게(윤곽 강조)

```bash
--edge-th 24 --tolerance 14 --min-region 120
```

### 너무 까맣게 뭉칠 때

```bash
--min-gap 2 --max-gap 12
```

### 테두리를 더 매끈하게

```bash
--outline-epsilon 2.0 --outline-smooth 2
```

### 빠르게 그리고 싶을 때

```bash
--max-side 200
--update-every 20
--speed 0
```

---

## 🧠 내부 처리 흐름

1. 이미지 로드 및 흑백 변환
2. 블러 전처리로 노이즈 완화
3. Sobel 에지 계산(경계 추정)
4. 에지-인식 Region Growing으로 영역 분할

   * 밝기 차이가 작으면 같은 면으로 확장
   * 강한 에지는 경계로 취급(넘지 않음)
5. 작은 영역 병합(밝기 평균이 가까운 인접 영역으로)
6. 영역 평균 밝기 계산
7. 영역 인접 그래프 생성
8. 4색 정리 → 해칭 방향 할당
9. 영역별 해칭 렌더링
10. 영역 경계 컨투어 추적 → 벡터 테두리 렌더링
11. 화면 크기에 맞춰 자동 스케일링 후 출력

---

## 📌 주의사항

* 이미지가 클수록 **렌더링 시간이 크게 증가**합니다
* 복잡한 이미지일수록 영역 수 증가 → 시간 증가
* 터틀 특성상 실시간 애니메이션은 CPU 사용량이 높습니다
* 결과는 **시각적/예술적 표현용**이며, 정확한 벡터 도형 분할을 목표로 하지는 않습니다
